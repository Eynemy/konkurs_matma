<!DOCTYPE html>
<html>
<head>
    <title>Koch Snowflake</title>
</head>
<body>
    <canvas id="canvas"></canvas><br>
    <button id="next">Next Iteration</button>
    <button id="reset">Reset</button><br>
    Iterations: <span id="iterations">0</span><br>
    Color: <input type="color" id="color" value="#000000">
    <script>
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");
        var nextButton = document.getElementById("next");
        var resetButton = document.getElementById("reset");
        var iterationsText = document.getElementById("iterations");
        var colorInput = document.getElementById("color");
        var iterations = 0;
        var points = [[100, 400], [500, 400], [300, 89.3]];
        canvas.width = 600;
        canvas.height = 600;
        ctx.fillStyle = colorInput.value;
        ctx.strokeStyle = colorInput.value;
        drawTriangle(points);
        nextButton.addEventListener("click", function() {
            nextIteration();
            iterations++;
            iterationsText.textContent = iterations;
        });
        resetButton.addEventListener("click", function() {
            reset();
            iterationsText.textContent = iterations;
        });
        colorInput.addEventListener("input", function() {
            ctx.fillStyle = this.value;
            ctx.strokeStyle = this.value;
            draw();
        });
        function nextIteration() {
            var newPoints = [];
            for (var i = 0; i < points.length; i++) {
                var a = points[i];
                var b = points[(i + 1) % points.length];
                var c = [
                    a[0] + (b[0] - a[0]) / 3,
                    a[1] + (b[1] - a[1]) / 3
                ];
                var d = [
                    a[0] + (b[0] - a[0]) * 2 / 3,
                    a[1] + (b[1] - a[1]) * 2 / 3
                ];
                var e = rotate(c, d, -Math.PI / 3);
                newPoints.push(a);
                newPoints.push(c);
                newPoints.push(e);
                newPoints.push(d);
            }
            points = newPoints;
            draw();
        }
        function reset() {
            points = [[100, 400], [500, 400], [300, 89.3]];
            iterations = 0;
            draw();
        }
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawTriangle(points);
        }
        function drawTriangle(points) {
            ctx.beginPath();
            ctx.moveTo(points[0][0], points[0][1]);
            for (var i = 1; i < points.length; i++) {
                ctx.lineTo(points[i][0], points[i][1]);
            }
            ctx.closePath();
            ctx.stroke();
        }
        function rotate(a, b, angle) {
            return [
                (a[0] - b[0]) * Math.cos(angle) - (a[1] - b[1]) * Math.sin(angle) + b[0],
                (a[0] - b[0]) * Math.sin(angle) + (a[1] - b[1]) * Math.cos(angle) + b[1]
            ];
        }
    </script>
</body>
</html>