<!DOCTYPE html>
<html>
<head>
    <title>Heighway Dragon</title>
</head>
<body>
    <canvas id="canvas"></canvas><br>
    <button id="next">Next Iteration</button>
    <button id="reset">Reset</button><br>
    Iterations: <span id="iterations">0</span><br>
    Color: <input type="color" id="color" value="#000000">
    <script>
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");
        var nextButton = document.getElementById("next");
        var resetButton = document.getElementById("reset");
        var iterationsText = document.getElementById("iterations");
        var colorInput = document.getElementById("color");
        var iterations = 0;
        var points = [[350, 350], [450, 350]];
        canvas.width = 800;
        canvas.height = 700;
        ctx.fillStyle = colorInput.value;
        ctx.strokeStyle = colorInput.value;
        drawLine(points);
        nextButton.addEventListener("click", function() {
            nextIteration();
            iterations++;
            iterationsText.textContent = iterations;
        });
        resetButton.addEventListener("click", function() {
            reset();
            iterationsText.textContent = iterations;
        });
        colorInput.addEventListener("input", function() {
            ctx.fillStyle = this.value;
            ctx.strokeStyle = this.value;
            draw();
        });
        function nextIteration() {
            var newPoints = [points[0]];
            for (var i = 0; i < points.length - 1; i++) {
                var a = points[i];
                var b = points[i + 1];
                var c = rotate(a, b, (i % 2 === 0) ? -Math.PI / 4 : Math.PI / 4);
                newPoints.push(c);
                newPoints.push(b);
            }
            points = newPoints;
            draw();
        }
        function reset() {
            points = [[350, 350], [450, 350]];
            iterations = 0;
            draw();
        }
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawLine(points);
        }
        function drawLine(points) {
            ctx.beginPath();
            ctx.moveTo(points[0][0], points[0][1]);
            for (var i = 1; i < points.length; i++) {
                ctx.lineTo(points[i][0], points[i][1]);
            }
            ctx.stroke();
        }
        function rotate(a, b, angle) {
            return [
                (b[0] - a[0]) * Math.cos(angle) - (b[1] - a[1]) * Math.sin(angle) + a[0],
                (b[0] - a[0]) * Math.sin(angle) + (b[1] - a[1]) * Math.cos(angle) + a[1]
            ];
        }
    </script>
</body>
</html>